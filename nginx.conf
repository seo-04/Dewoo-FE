events {}

http {
    include       mime.types;
    default_type  application/octet-stream;
    sendfile        on;
    keepalive_timeout  65;

    server {
        listen 80;
        # 1. 서버 이름을 실제 IP 주소 또는 도메인으로 변경합니다.
        server_name 43.203.121.130;

        # Vue 프로젝트의 빌드 파일(dist 폴더 안의 내용물)이 위치하는 경로를 지정합니다.
        # 경로는 실제 환경에 맞게 수정해야 할 수 있습니다.
        root /usr/share/nginx/html;
        index index.html;

        # 2. API 요청('/api'로 시작하는 모든 요청)을 백엔드로 전달합니다.
        # 이 부분은 잘 되어 있으므로 그대로 둡니다.
        location /api/ {
            proxy_pass http://localhost:8085;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # 3. API 요청이 아닌 다른 모든 요청에 대한 처리입니다.
        # 이 부분이 Vue Router가 정상적으로 작동하게 하는 핵심입니다.
        location / {
            # 요청된 URI에 해당하는 파일이 있으면 그 파일을 반환하고,
            # 없으면 index.html을 반환하여 Vue Router가 경로를 처리하도록 합니다.
            try_files $uri $uri/ /index.html;
        }
    }
}